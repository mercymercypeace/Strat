local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local GuiService = game:GetService("GuiService")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local isMobile = UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled
local screenSize = GuiService:GetScreenSize()
local scale = isMobile and math.min(screenSize.X / 1920, screenSize.Y / 1080) or 1
local mobileScale = isMobile and 1.5 or 1

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "StatsGUI"
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
screenGui.Parent = playerGui

local frameWidth = math.floor(300 * scale * mobileScale)
local frameHeight = math.floor(450 * scale * mobileScale)
local titleBarHeight = math.floor(40 * scale * mobileScale)

local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = isMobile and UDim2.new(0.8, 0, 0, frameHeight) or UDim2.new(0, frameWidth, 0, frameHeight)
mainFrame.Position = isMobile and UDim2.new(0.1, 0, 0.1, 0) or UDim2.new(0.5, -frameWidth/2, 0.5, -frameHeight/2)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.BackgroundTransparency = 1
mainFrame.BorderSizePixel = 0
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, math.floor(8 * scale * mobileScale))
corner.Parent = mainFrame

local titleBar = Instance.new("Frame")
titleBar.Name = "TitleBar"
titleBar.Size = UDim2.new(1, 0, 0, titleBarHeight)
titleBar.Position = UDim2.new(0, 0, 0, 0)
titleBar.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
titleBar.BorderSizePixel = 0
titleBar.Parent = mainFrame

local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, math.floor(8 * scale * mobileScale))
titleCorner.Parent = titleBar

local titleText = Instance.new("TextLabel")
titleText.Name = "TitleText"
titleText.Size = UDim2.new(1, -math.floor(80 * scale * mobileScale), 1, 0)
titleText.Position = UDim2.new(0, math.floor(10 * scale * mobileScale), 0, 0)
titleText.BackgroundTransparency = 1
titleText.Text = player.Name .. "'s Stats"
titleText.TextColor3 = Color3.fromRGB(255, 255, 255)
titleText.TextSize = math.floor(18 * scale * mobileScale)
titleText.Font = Enum.Font.GothamBold
titleText.TextXAlignment = Enum.TextXAlignment.Left
titleText.TextScaled = isMobile
titleText.Parent = titleBar

local buttonSize = math.floor(30 * scale * mobileScale)
local buttonPadding = math.floor(5 * scale * mobileScale)

local minimizeButton = Instance.new("TextButton")
minimizeButton.Name = "MinimizeButton"
minimizeButton.Size = UDim2.new(0, buttonSize, 0, buttonSize)
minimizeButton.Position = UDim2.new(1, -math.floor(70 * scale * mobileScale), 0, buttonPadding)
minimizeButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
minimizeButton.BorderSizePixel = 0
minimizeButton.Text = "-"
minimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
minimizeButton.TextSize = math.floor(20 * scale * mobileScale)
minimizeButton.Font = Enum.Font.GothamBold
minimizeButton.TextScaled = isMobile
minimizeButton.Parent = titleBar

local minimizeCorner = Instance.new("UICorner")
minimizeCorner.CornerRadius = UDim.new(0, math.floor(4 * scale * mobileScale))
minimizeCorner.Parent = minimizeButton

local closeButton = Instance.new("TextButton")
closeButton.Name = "CloseButton"
closeButton.Size = UDim2.new(0, buttonSize, 0, buttonSize)
closeButton.Position = UDim2.new(1, -math.floor(35 * scale * mobileScale), 0, buttonPadding)
closeButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
closeButton.BorderSizePixel = 0
closeButton.Text = "X"
closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
closeButton.TextSize = math.floor(18 * scale * mobileScale)
closeButton.Font = Enum.Font.GothamBold
closeButton.TextScaled = isMobile
closeButton.Parent = titleBar

local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(0, math.floor(4 * scale * mobileScale))
closeCorner.Parent = closeButton

local contentPadding = math.floor(10 * scale * mobileScale)
local contentFrame = Instance.new("ScrollingFrame")
contentFrame.Name = "ContentFrame"
contentFrame.Size = UDim2.new(1, -contentPadding*2, 1, -titleBarHeight - contentPadding)
contentFrame.Position = UDim2.new(0, contentPadding, 0, titleBarHeight)
contentFrame.BackgroundTransparency = 1
contentFrame.BorderSizePixel = 0
contentFrame.ScrollBarThickness = math.floor(6 * scale * mobileScale)
contentFrame.Parent = mainFrame

local listLayout = Instance.new("UIListLayout")
listLayout.Padding = UDim.new(0, math.floor(10 * scale * mobileScale))
listLayout.SortOrder = Enum.SortOrder.LayoutOrder
listLayout.Parent = contentFrame

local originalSize = mainFrame.Size
local isMinimized = false

local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Linear, Enum.EasingDirection.InOut)

local openPosition = isMobile and UDim2.new(0.1, 0, 0.1, 0) or UDim2.new(0.5, -frameWidth/2, 0.5, -frameHeight/2)
local openTween = TweenService:Create(mainFrame, tweenInfo, {
    BackgroundTransparency = 0,
    Position = openPosition
})
openTween:Play()

minimizeButton.MouseButton1Click:Connect(function()
    isMinimized = not isMinimized
    if isMinimized then
        local minimizedSize = isMobile and UDim2.new(0.8, 0, 0, titleBarHeight) or UDim2.new(0, frameWidth, 0, titleBarHeight)
        local minimizeTween = TweenService:Create(mainFrame, tweenInfo, {
            Size = minimizedSize
        })
        minimizeTween:Play()
        spawn(function()
            wait(0.15)
            contentFrame.Visible = false
        end)
    else
        contentFrame.Visible = true
        local restoreTween = TweenService:Create(mainFrame, tweenInfo, {
            Size = originalSize
        })
        restoreTween:Play()
    end
end)

closeButton.MouseButton1Click:Connect(function()
    local closeTween = TweenService:Create(mainFrame, tweenInfo, {
        BackgroundTransparency = 1,
        Size = UDim2.new(0, 0, 0, 0)
    })
    closeTween:Play()
    closeTween.Completed:Connect(function()
        screenGui:Destroy()
    end)
end)

minimizeButton.MouseEnter:Connect(function()
    local hoverTween = TweenService:Create(minimizeButton, TweenInfo.new(0.2, Enum.EasingStyle.Linear), {
        BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    })
    hoverTween:Play()
end)

minimizeButton.MouseLeave:Connect(function()
    local hoverTween = TweenService:Create(minimizeButton, TweenInfo.new(0.2, Enum.EasingStyle.Linear), {
        BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    })
    hoverTween:Play()
end)

closeButton.MouseEnter:Connect(function()
    local hoverTween = TweenService:Create(closeButton, TweenInfo.new(0.2, Enum.EasingStyle.Linear), {
        BackgroundColor3 = Color3.fromRGB(255, 70, 70)
    })
    hoverTween:Play()
end)

closeButton.MouseLeave:Connect(function()
    local hoverTween = TweenService:Create(closeButton, TweenInfo.new(0.2, Enum.EasingStyle.Linear), {
        BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    })
    hoverTween:Play()
end)

local function createStatLabel(statName, value)
    local statFrameHeight = math.floor(50 * scale * mobileScale)
    local statPadding = math.floor(10 * scale * mobileScale)
    local statInnerPadding = math.floor(5 * scale * mobileScale)
    
    local statFrame = Instance.new("Frame")
    statFrame.Name = statName .. "Frame"
    statFrame.Size = UDim2.new(1, 0, 0, statFrameHeight)
    statFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    statFrame.BorderSizePixel = 0
    statFrame.Parent = contentFrame
    
    local statCorner = Instance.new("UICorner")
    statCorner.CornerRadius = UDim.new(0, math.floor(6 * scale * mobileScale))
    statCorner.Parent = statFrame
    
    local statNameLabel = Instance.new("TextLabel")
    statNameLabel.Name = "StatName"
    statNameLabel.Size = UDim2.new(0.5, -statPadding, 1, -statInnerPadding*2)
    statNameLabel.Position = UDim2.new(0, statPadding, 0, statInnerPadding)
    statNameLabel.BackgroundTransparency = 1
    statNameLabel.Text = statName .. ":"
    statNameLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    statNameLabel.TextSize = math.floor(16 * scale * mobileScale)
    statNameLabel.Font = Enum.Font.Gotham
    statNameLabel.TextXAlignment = Enum.TextXAlignment.Left
    statNameLabel.TextScaled = isMobile
    statNameLabel.Parent = statFrame
    
    local statValueLabel = Instance.new("TextLabel")
    statValueLabel.Name = "StatValue"
    statValueLabel.Size = UDim2.new(0.5, -statPadding, 1, -statInnerPadding*2)
    statValueLabel.Position = UDim2.new(0.5, 0, 0, statInnerPadding)
    statValueLabel.BackgroundTransparency = 1
    statValueLabel.Text = tostring(value)
    statValueLabel.TextColor3 = Color3.fromRGB(100, 200, 255)
    statValueLabel.TextSize = math.floor(16 * scale * mobileScale)
    statValueLabel.Font = Enum.Font.GothamBold
    statValueLabel.TextXAlignment = Enum.TextXAlignment.Right
    statValueLabel.TextScaled = isMobile
    statValueLabel.Parent = statFrame
    
    return statValueLabel
end

local function getPlayerStats()
    local stats = {
        Coins = 0,
        Experience = 0,
        Gems = 0,
        Triumphs = 0,
        Loses = 0,
        Level = 0
    }
    
    local coins = player:FindFirstChild("Coins") or player:FindFirstChild("coins")
    local experience = player:FindFirstChild("Experience") or player:FindFirstChild("experence")
    local gems = player:FindFirstChild("Gems") or player:FindFirstChild("gems")
    local triumphs = player:FindFirstChild("Triumphs") or player:FindFirstChild("triumps")
    local loses = player:FindFirstChild("Loses") or player:FindFirstChild("loses")
    local level = player:FindFirstChild("Level") or player:FindFirstChild("level")
    
    if coins then stats.Coins = coins.Value end
    if experience then stats.Experience = experience.Value end
    if gems then stats.Gems = gems.Value end
    if triumphs then stats.Triumphs = triumphs.Value end
    if loses then stats.Loses = loses.Value end
    if level then stats.Level = level.Value end
    
    return stats
end

local stats = getPlayerStats()
local statLabels = {}

statLabels.Coins = createStatLabel("Coins", stats.Coins)
statLabels.Experience = createStatLabel("Experience", stats.Experience)
statLabels.Gems = createStatLabel("Gems", stats.Gems)
statLabels.Triumphs = createStatLabel("Triumphs", stats.Triumphs)
statLabels.Loses = createStatLabel("Loses", stats.Loses)
statLabels.Level = createStatLabel("Level", stats.Level)

local canvasPadding = math.floor(20 * scale * mobileScale)
contentFrame.CanvasSize = UDim2.new(0, 0, 0, listLayout.AbsoluteContentSize.Y + canvasPadding)

listLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    contentFrame.CanvasSize = UDim2.new(0, 0, 0, listLayout.AbsoluteContentSize.Y + canvasPadding)
end)

local function updateStats()
    local newStats = getPlayerStats()
    if statLabels.Coins then statLabels.Coins.Text = tostring(newStats.Coins) end
    if statLabels.Experience then statLabels.Experience.Text = tostring(newStats.Experience) end
    if statLabels.Gems then statLabels.Gems.Text = tostring(newStats.Gems) end
    if statLabels.Triumphs then statLabels.Triumphs.Text = tostring(newStats.Triumphs) end
    if statLabels.Loses then statLabels.Loses.Text = tostring(newStats.Loses) end
    if statLabels.Level then statLabels.Level.Text = tostring(newStats.Level) end
end

for _, stat in pairs(player:GetChildren()) do
    local statName = stat.Name:lower()
    if (statName == "coins" or statName == "experience" or statName == "experence" or 
        statName == "gems" or statName == "triumphs" or statName == "triumps" or 
        statName == "loses" or statName == "level") and 
        (stat:IsA("IntValue") or stat:IsA("NumberValue") or stat:IsA("StringValue")) then
        stat.Changed:Connect(function()
            updateStats()
        end)
    end
end

player.ChildAdded:Connect(function(child)
    local statName = child.Name:lower()
    if (statName == "coins" or statName == "experience" or statName == "experence" or 
        statName == "gems" or statName == "triumphs" or statName == "triumps" or 
        statName == "loses" or statName == "level") and 
        (child:IsA("IntValue") or child:IsA("NumberValue") or child:IsA("StringValue")) then
        child.Changed:Connect(function()
            updateStats()
        end)
    end
end)

spawn(function()
    while wait(1) do
        updateStats()
    end
end)

